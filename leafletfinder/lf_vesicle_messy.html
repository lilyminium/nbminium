

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Finding leaflets in a vesicle with other stuff &mdash; Python  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/psyduck_Ag1_icon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Finding leaflets in a vesicle" href="lf_vesicle.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/psyduck_smaller.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="README.html">Finding leaflets</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lf_single_bilayer.html">Finding leaflets in a single planar bilayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="lf_double_bilayer.html">Finding leaflets in a double planar bilayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="lf_vesicle.html">Finding leaflets in a vesicle</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Finding leaflets in a vesicle with other stuff</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Entire-membrane">Entire membrane</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Graph">Graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Spectral-clustering">Spectral clustering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Orientation">Orientation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Half-the-residues">Half the residues</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Orientation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#A-fifth-of-the-residues">A fifth of the residues</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">Orientation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="README.html">Finding leaflets</a> &raquo;</li>
        
      <li>Finding leaflets in a vesicle with other stuff</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/leafletfinder/lf_vesicle_messy.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<script src='http://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js'></script>
<script>require=requirejs;</script><div class="section" id="Finding-leaflets-in-a-vesicle-with-other-stuff">
<h1>Finding leaflets in a vesicle with other stuff<a class="headerlink" href="#Finding-leaflets-in-a-vesicle-with-other-stuff" title="Permalink to this headline">¶</a></h1>
<p>This notebook demonstrates the performance of different algorithms for finding leaflets in a vesicle that has not finished aggregating, and discusses some pitfalls in the “orientation” method. I also have a different notebook demonstrating much better performance on a <a class="reference internal" href="lf_vesicle.html"><span class="doc">tidier vesicle</span></a>.</p>
<p>I obtained this file from the <a class="reference external" href="https://pythonhosted.org/fatslim/documentation/tutorials.html">FATSLiM tutorial here</a>.</p>
<p>The particle groups analysed are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">u</span></code>: the entire vesicle</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">half</span></code>: half the membrane, randomly dispersed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fifth</span></code>: 1/5th the membrane, randomly dispersed</p></li>
</ul>
<p>In summary, this is pretty hard. “orientation” is actually sensitive to the <code class="docutils literal notranslate"><span class="pre">cutoff</span></code>, because it considers any lipids within <code class="docutils literal notranslate"><span class="pre">cutoff</span></code> distance of each other to potentially be in the same leaflet, provided they oriented at acute angles.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">MDAnalysis</span> <span class="k">as</span> <span class="nn">mda</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">nglview</span> <span class="k">as</span> <span class="nn">nv</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.analysis.leaflet</span> <span class="kn">import</span> <span class="n">LeafletFinder</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.tests.datafiles</span> <span class="kn">import</span> <span class="n">DPPC_vesicle_plus</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0a4523ad743d4bc9a08ec89988b1b470", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">u</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">DPPC_vesicle_plus</span><span class="p">)</span>
<span class="n">half</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">residues</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span>
<span class="n">fifth</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">residues</span><span class="p">[::</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">show_leaflets</span><span class="p">(</span><span class="n">ag</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="s2">&quot;name PO4 GL1 ROH&quot;</span><span class="p">,</span> <span class="n">n_groups</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                  <span class="n">superset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get and show the leaflets. The first and second largest</span>
<span class="sd">    leaflets are coloured. If answers are given in `superset`,</span>
<span class="sd">    they are compared.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">ag</span><span class="o">.</span><span class="n">universe</span>
    <span class="n">lf</span> <span class="o">=</span> <span class="n">LeafletFinder</span><span class="p">(</span><span class="n">ag</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">select</span><span class="p">,</span>
                       <span class="n">n_groups</span><span class="o">=</span><span class="n">n_groups</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">n_residues</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">lf</span><span class="o">.</span><span class="n">sizes</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">leaflets</span><span class="p">)</span><span class="si">}</span><span class="s2"> leaflets: </span><span class="si">{</span><span class="n">n_residues</span><span class="si">}</span><span class="s2"> residues&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">superset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">known</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span> <span class="n">superset</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">found</span> <span class="o">-</span> <span class="n">known</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Leaflet </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> is not within superset: &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span><span class="si">}</span><span class="s2"> extra residues&quot;</span><span class="p">)</span>
    <span class="n">u</span><span class="o">.</span><span class="n">add_TopologyAttr</span><span class="p">(</span><span class="s1">&#39;tempfactors&#39;</span><span class="p">)</span>
    <span class="n">lf1</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">atoms</span>
    <span class="n">lf1</span><span class="o">.</span><span class="n">tempfactors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lf1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="n">lf2</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">atoms</span>
    <span class="n">lf2</span><span class="o">.</span><span class="n">tempfactors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lf2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">10</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">leaflet</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">lfi</span> <span class="o">=</span> <span class="n">leaflet</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">atoms</span>
        <span class="n">lfi</span><span class="o">.</span><span class="n">tempfactors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lfi</span><span class="p">))</span> <span class="o">*</span> <span class="n">i</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">nv</span><span class="o">.</span><span class="n">show_mdanalysis</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>
    <span class="n">view</span><span class="o">.</span><span class="n">clear_representations</span><span class="p">()</span>
    <span class="n">view</span><span class="o">.</span><span class="n">add_representation</span><span class="p">(</span><span class="s1">&#39;spacefill&#39;</span><span class="p">,</span> <span class="n">color_scheme</span><span class="o">=</span><span class="s1">&#39;bfactor&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">view</span>

<span class="k">def</span> <span class="nf">get_leaflets</span><span class="p">(</span><span class="n">ag</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="s2">&quot;name PO4 GL1 ROH&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">LeafletFinder</span><span class="p">(</span><span class="n">ag</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">select</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Entire-membrane">
<h2>Entire membrane<a class="headerlink" href="#Entire-membrane" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Graph">
<h3>Graph<a class="headerlink" href="#Graph" title="Permalink to this headline">¶</a></h3>
<p>“graph” does quite well; although I only see 2 leaflets + 6 blobs, whereas it’s found 9 groups.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_leaflets</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;graph&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 9 leaflets: 3702, 2358, 4, 50, 14, 2, 10, 2, 2 residues
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b9aeb7124eed4827a4c5a6c5121bb178", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p><img alt="graph_1" src="../_images/lf_vesicle_messy_or_4.png" /></p>
<p>Images are embedded to save space, instead of nglview widgets.</p>
<p>Below I grab these leaflets so I can use them to ascertain the correctness of the the <code class="docutils literal notranslate"><span class="pre">half</span></code> and <code class="docutils literal notranslate"><span class="pre">fifth</span></code> atom groups, where it becomes a bit hard to see which leaflet is which.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lf</span> <span class="o">=</span> <span class="n">LeafletFinder</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="s2">&quot;name PO4 GL1 ROH&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;graph&quot;</span><span class="p">)</span>
<span class="n">superset</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">groups</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Spectral-clustering">
<h3>Spectral clustering<a class="headerlink" href="#Spectral-clustering" title="Permalink to this headline">¶</a></h3>
<p>Spectral clustering is having big, big issues.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_leaflets</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;spectralclustering&quot;</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">superset</span><span class="o">=</span><span class="n">superset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 8 leaflets: 964, 956, 916, 890, 886, 746, 736, 50 residues
Leaflet 1 is not within superset: 6 extra residues
Leaflet 2 is not within superset: 956 extra residues
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "87dbc9ed730549d4b49122f025ecf3b5", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p><img alt="graph_1" src="../_images/lf_vesicle_messy_or_4.png" /></p>
<p>Reducing the number of groups helps a little, although it’s grouped most of the extra ones into the outer leaflet….</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_leaflets</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;spectralclustering&quot;</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">superset</span><span class="o">=</span><span class="n">superset</span><span class="p">,</span> <span class="n">n_groups</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 3 leaflets: 3736, 2358, 50 residues
Leaflet 1 is not within superset: 34 extra residues
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cdb4af98df1541dabaa8e60d350a714a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p><img alt="graph_1" src="../_images/lf_vesicle_messy_or_4.png" /></p>
<p>I won’t time this or keep comparing how “spectralclustering” works for the other examples.</p>
</div>
<div class="section" id="Orientation">
<h3>Orientation<a class="headerlink" href="#Orientation" title="Permalink to this headline">¶</a></h3>
<p>Orientation works with the default cutoff, although whatever the 6 blobs are is not clear.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_leaflets</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="n">superset</span><span class="o">=</span><span class="n">superset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 8 leaflets: 3702, 2358, 28, 16, 16, 12, 6, 6 residues
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "146081969cc34b699836087c6ab42fde", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p><img alt="graph_1" src="../_images/lf_vesicle_messy_or_4.png" /></p>
<p>Below I demonstrate that increasing the cutoff does not <em>always</em> increase the accuracy, though (even though I’ve claimed somewhere that it does increase it monotonically). That’s because the algorithm considers all lipids within the cutoff to potentially belong to the same leaflet, providing that they have similar orientations. This, in addition to specifying how many groups you want, means it can do weird things like the below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_leaflets</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">superset</span><span class="o">=</span><span class="n">superset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 8 leaflets: 3794, 2322, 12, 8, 2, 2, 2, 2 residues
Leaflet 1 is not within superset: 94 extra residues
Leaflet 2 is not within superset: 14 extra residues
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fbe320bf460d474ea55d33ec0780a240", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p><img alt="graph_1" src="../_images/lf_vesicle_messy_or_4.png" /></p>
</div>
</div>
<div class="section" id="Half-the-residues">
<h2>Half the residues<a class="headerlink" href="#Half-the-residues" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Graph<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Graph does pretty well here on the default cutoff again.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_leaflets</span><span class="p">(</span><span class="n">half</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="n">superset</span><span class="o">=</span><span class="n">superset</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 10 leaflets: 1868, 1162, 24, 2, 4, 2, 2, 4, 2, 2 residues
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "dd30ceee3d5e41a981167c31d9766bc3", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p><img alt="graph_1" src="../_images/lf_vesicle_messy_or_4.png" /></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">timeit</span> get_leaflets(half, method=&quot;graph&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
150 ms ± 2.91 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
</div>
<div class="section" id="id2">
<h3>Orientation<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The default settings here don’t quite work, as they have pulled in 2 extra lipids.</p>
<p>This is likely because we have specified <code class="docutils literal notranslate"><span class="pre">n_groups=8</span></code> and it has achieved that by associating the smallest group (2 lipids) with the closest large group.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_leaflets</span><span class="p">(</span><span class="n">half</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="n">superset</span><span class="o">=</span><span class="n">superset</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Well, we only really care about the 2 actual leaflets. I can take advantage of that by only choosing to find 2 groups, and by using the <code class="docutils literal notranslate"><span class="pre">min_group</span></code> keyword to specify that each leaflet should have at least 20 lipids.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_leaflets</span><span class="p">(</span><span class="n">half</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="n">n_groups</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_group</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">superset</span><span class="o">=</span><span class="n">superset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 2 leaflets: 1868, 1162 residues
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a881c58ce34f489db4502453e8603ffa", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p><img alt="graph_1" src="../_images/lf_vesicle_messy_or_4.png" /></p>
</div>
</div>
<div class="section" id="A-fifth-of-the-residues">
<h2>A fifth of the residues<a class="headerlink" href="#A-fifth-of-the-residues" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Graph<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>“graph” is actually doing quite well here, I think! But it’s missing some and added some extra lipids.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_leaflets</span><span class="p">(</span><span class="n">fifth</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">superset</span><span class="o">=</span><span class="n">superset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 11 leaflets: 730, 462, 18, 4, 2, 2, 2, 4, 2, 2, 2 residues
Leaflet 1 is not within superset: 2 extra residues
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5382c45cd6a941c2acc75852189182e9", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p><img alt="graph_1" src="../_images/lf_vesicle_messy_or_4.png" /></p>
</div>
<div class="section" id="id4">
<h3>Orientation<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_leaflets</span><span class="p">(</span><span class="n">fifth</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="n">n_groups</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_group</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
              <span class="n">cutoff</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">superset</span><span class="o">=</span><span class="n">superset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 2 leaflets: 754, 464 residues
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b26394b72e3d488b93439e7b12ac19dc", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p><img alt="graph_1" src="../_images/lf_vesicle_messy_or_4.png" /></p>
<p>Again, this is sensitive to the cutoff to avoid including those extra lipids.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_leaflets</span><span class="p">(</span><span class="n">fifth</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="n">n_groups</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_group</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
              <span class="n">cutoff</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">superset</span><span class="o">=</span><span class="n">superset</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="lf_vesicle.html" class="btn btn-neutral float-left" title="Finding leaflets in a vesicle" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>